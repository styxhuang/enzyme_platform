version: '3.8'
services:
  api:
    build: ./backend
    container_name: enzyme_api
    ports:
      - "7010:8000"
    volumes:
      - ./data:/data
      - ./frontend/dist:/app/static
    environment:
      - ENZYME_DATA_DIR=/data
      - UPLOAD_ASSETS=/data/assets
      - ENZYME_JWT_SECRET=change_this_secret
      - ENZYME_STATIC_DIR=/app/static
    depends_on:
      - mod-smol
      - mod-af2
      - mod-dock
      - mod-md
      - mod-analysis
  frontend:
    build: ./frontend
    container_name: enzyme_frontend
    ports:
      - "7006:80"
    volumes:
      - ./data:/data
    depends_on:
      - api
  mod-smol:
    build: ./modules/smol
    container_name: enzyme_mod_smol
    ports:
      - "7001:8001"
    volumes:
      - ./data:/data
    environment:
      - ENZYME_DATA_DIR=/data
  mod-af2:
    build: ./modules/af2
    container_name: enzyme_mod_af2
    ports:
      - "7002:8002"
    volumes:
      - ./data:/data
    environment:
      - ENZYME_DATA_DIR=/data
  mod-dock:
    build: ./modules/dock
    container_name: enzyme_mod_dock
    ports:
      - "7003:8003"
    volumes:
      - ./data:/data
    environment:
      - ENZYME_DATA_DIR=/data
      - VINA_SERVICE_URL=http://mod-vina:8006/run
    depends_on:
      - mod-vina
  mod-md:
    build: ./modules/md
    container_name: enzyme_mod_md
    ports:
      - "7004:8004"
    volumes:
      - ./data:/data
    environment:
      - ENZYME_DATA_DIR=/data
  mod-analysis:
    build: ./modules/analysis
    container_name: enzyme_mod_analysis
    ports:
      - "7005:8005"
    volumes:
      - ./data:/data
    environment:
      - ENZYME_DATA_DIR=/data
  mod-vina:
    build: ./modules/vina
    container_name: enzyme_mod_vina
    ports:
      - "7007:8006"
    volumes:
      - ./data:/data
    environment:
      - ENZYME_DATA_DIR=/data

volumes:
  data:
    driver: local

networks:
  default:
    driver: bridge
    driver_opts:
      com.docker.network.enable_ipv6: "false"